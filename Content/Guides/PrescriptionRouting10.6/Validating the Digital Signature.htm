<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" xml:lang="en-us" MadCap:lastBlockDepth="4" MadCap:lastHeight="786" MadCap:lastWidth="624">
    <head><title></title>
    </head>
    <body>
        <h2 class="Heading2" MadCap:autonum="0.1 "><a name="_Toc443643396"></a>Validating the Digital Signature</h2>
        <p class="BodyText1">Validating a signature is very similar to creating a signature. In both cases, information is identified and run through a secure hashing function. The main difference is that when validating, the resulting hash is compared with the hash contained in the message, which is obtained by decrypting the signature value using the public key in the certificate that is sent within the message header. The first two steps are identical to the signature generation.</p>
        <ol>
            <li>Select the fields to be signed and create a single plain text string.<br /><br />The value of the fields listed in <MadCap:xref href="Fields Required to be Digitally.htm">Fields Required to be Digitally Signed on page&#160;1</MadCap:xref> are required to be selected in the specified order and concatenated into a single plain text string.<br /><br />The plain text string should not use any field separators or include additional characters that are not the same values communicated in the data field.<br /><br />The fields are required to be constrained to the alpha-numeric character set matching the pattern [ !-~]* or a more restrictive pattern as defined by the implementation guide. Trailing and leading whitespace should be included exactly as sent in the message.<br /><br />The plain text string should not use XML escaping. If the prescriber wished to send the literal value of "&gt; 100 degrees" in a field DO NOT change this to "&amp;gt; 100 degrees" when creating the plain text string.<br /><br />If the field is constrained to a code set, then the value of the code should be included in the plaintext string, not the value. For example, DRU-060-01 (Refill quantity qualifier) should include "PRN" in the plaintext string not "As Needed".</li>
            <li>Calculate the Digest Value of the Plain Text String.<br /><br />The ASCII encoded plain text string will be reduced to a unique <span style="font-weight: bold;">DigestValue</span>, using a SHA-1 hash. Note, because all customers on the Surescripts network are required to agree on a single method for signing and verifying a digital signature, additional secure hash algorithms such as SHA-256 will not be supported in version 10.6.</li>
            <li>Decrypt the Signature Value.<br /><br />The signature value is an encrypted version of the hash of the signed information (the concatenation of all the fields in table 7.2). The hash value is also in the DigestValue (for troubleshooting purposes). The sender's private key is what was used to encrypt the digest to create the SignatureValue. The SignatureValue can only be decrypted with the sender's public key, which is contained in the attached digital certificate in the X509Data element.</li>
            <li>Compare the Digests.<br /><br />The <span style="font-weight: bold;">DigestValue</span> that the recipient calculates will match the <span style="font-weight: bold;">DigestValue</span> from the decrypted signature if the signature is valid.</li>
            <li>Validate the Certificate.<br /><br />In addition to validating the signature, the receiving application is required to also ensure that the certificate used to sign the message is valid. Some applications may choose to perform this step before validating the signature. A message should only be accepted as valid if it has been signed and verified with a valid digital certificate.</li>
        </ol>
    </body>
</html>